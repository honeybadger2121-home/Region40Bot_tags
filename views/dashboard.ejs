<!DOCTYPE html>
<html>
<head>
  <title>Onboarding Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>🧭 Onboarding Dashboard</h1>
  <p>Total Users: <%= typeof total !== 'undefined' ? total : 0 %></p>
  <p>✅ Verified: <%= typeof verified !== 'undefined' ? verified : 0 %></p>
  <p>🖊️ Profile Completed: <%= typeof profiled !== 'undefined' ? profiled : 0 %></p>
  <p>🛡️ Alliance Selected: <%= typeof withAlliance !== 'undefined' ? withAlliance : 0 %></p>

  <h2>📋 Recent Onboardings</h2>
  <ul>
    <% (Array.isArray(recent) ? recent : []).forEach(function(user) { %>
      <li><%= user.userId || 'Unknown User' %> — <%= user.alliance || 'No Alliance' %></li>
    <% }) %>
  </ul>

  <h2>📊 Alliance Distribution</h2>
  <% if (allianceCounts && Object.keys(allianceCounts).length > 0) { %>
    <canvas id="allianceChart" width="400" height="400"></canvas>
    <script>
      const allianceLabels = <%- JSON.stringify(Object.keys(allianceCounts)) %>;
      const allianceData = <%- JSON.stringify(Object.values(allianceCounts)) %>;
      const ctx = document.getElementById('allianceChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: allianceLabels,
          datasets: [{
            data: allianceData,
            backgroundColor: ['#FFD700', '#FFFFFF', '#800080', '#FF0000', '#0000FF', '#8B4513', '#00BFFF']
          }]
        }
      });
    </script>
  <% } else { %>
    <p>No alliance data available.</p>
  <% } %>
</body>
</html>
